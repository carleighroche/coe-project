<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="styles.css">
        <script src="https://d3js.org/d3.v7.min.js"></script>
    </head>
    <body>
        <h1>Greenidge Power Plant Noise </h1>
        <h3><i>INFO 4260, Prof Steven Jackson</i></h3>
        <h3>Carleigh Roche, Estelle Hooper, Hal Reed, Sarah Langleben</h3>
        <div id="bitcoin activity">
            <p width="600">Measure of Bitcoin Activity (2018-2022)</p>
            <svg width="600", height="600"></svg>
            <script>
                // request data 
                const requestData = async () => {
                    let bitcoinActivity = await d3.csv("btc-daily.csv");
                    console.log(bitcoinActivity);
                    let svg = d3.select("svg");
                    let width = svg.attr("width");
                    let height = svg.attr("height");

                    // x scale (date)
                    const dates = [];
                    bitcoinActivity.forEach( d => {
                        var date = new Date(d['date']);
                        dates.push(date);    
                    });
                    // console.log(dates);
                    const xExtent = d3.extent(bitcoinActivity, d=> new Date(d.date));
                    console.log(xExtent);

                    let xScale = d3.scaleTime()
                        .domain(xExtent) //from data
                        .range([10, width-10])
                    
                    // y scale (volume of tokens exchanged)
                    const yExtent = d3.extent(bitcoinActivity, d => d['volume-btc']);
                    console.log(yExtent) // y extent not working...figure this out
                    let yScale = d3.scaleLinear()
                        .domain([0, 50000])
                        .range([10, height-50]);

                    // create axes
                    let leftAxis = d3.axisLeft(yScale).tickFormat(d3.format(.0));
                    let leftGridlines = d3.axisLeft(yScale)
                                         .tickSize(-width - 10)
                                         .tickFormat('');
                    
                    let bottomAxis = d3.axisBottom(xScale);

                    var lineGen = d3.line()
                        .x(d => xScale(d['date']))
                        .y(d => yScale(d['volume-btc']))
                        .curve(d3.curveNatural);

                    svg.selectAll('circle').data(bitcoinActivity).join('circle')
                            .attr("cx", d=> xScale(Date.parse(d['date'])))
                            .attr("cy", d => yScale(d['volume-btc']))
                            .attr('r', 1)
                            .style('fill', '#52c5ff');

                    svg.append('g').call(bottomAxis).attr("class", "xaxis")
                             .attr("transform",`translate(0, 580)`);
                    
                    svg.append('path').datum(bitcoinActivity)
                        .attr('class', 'line')
                        .attr('fill', 'none')
                        .attr('stroke', 'red')
                        .attr('stroke-width', 1)
                        .attr('d', lineGen);

                    };
                    
                requestData();
            </script>
        </div>
        <div id="bubble graph">

        </div>
    </body>
</html>